#!/bin/bash

# === Ctrl + C === #
ctrl_c () {
  echo "\n\n[!] Exiting...\n"
  tput cnorm; exit 1
}
trap ctrl_c INT

# === Hiding cursor === #
tput civis


# === Logging function === #
log () {
  echo "$1\n"; sleep 2
}


# === Arguments check === #
if [ $# -ne 1 ]; then
  echo "usage: ./pingu <USER> (Execute script as ROOT)"
  exit 1
fi
if [ -z "$1" ]; then
  echo "usage: ./pingu <USER> (Execute script as ROOT)"
  exit 1
fi
if id "$1" &>/dev/null; then
  USER=$1
else
  log "User provided does not exist :("
  exit 1
fi


# === Banner === #
bash ./assets/banner.sh


# === GRUB Theme === #
log "[*] Configuring GRUB Theme..."
cp -r /usr/share/Pingu/config/CyberRe /usr/share/grub/themes/CyberRe
log "[+] GRUB Theme Configured!"


# === Package installation === #
log "[*] Installing Packages..."
sudo pacman -S xorg nvidia xclip qtile neofetch
yay -S nerd-fonts-jetbrains-mono
log "[+] Packages Installed


# === Blackarch === #


# === ZSH === #
log "[*] Configuring ZSH Shell..."
mkdir -p /usr/share/custom-zsh/zsh-sudo
chown $USER:$USER /usr/share/custom-zsh/zsh-sudo
git clone "https://github.com/zsh-users/zsh-syntax-highlighting" /usr/share/custom-zsh/zsh-syntax-highlighting
git clone "https://github.com/zsh-users/zsh-autosuggestions" /usr/share/custom-zsh/zsh-autosuggestions
cd /usr/share/custom-zsh/zsh-sudo && wget "https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/plugins/sudo/sudo.plugin.zsh"
usermod --shell /usr/bin/zsh $USER
usermod --shell /usr/bin/zsh root
log "[+] ZSH Shell Configured!"


# === Powerlevel10k === #
sleep 1


# === Picom === #
sleep 1


# === Qtile === #
log "[*] Configuring Qtile (WM)..."
cp -r /usr/share/Pingu/config/qtile /home/$USER/.config/qtile
log "[+] Qtile Configured!"


# === Neovim - NvChad === #
log "[?] Checking if Neovim is installed..."
if [ command -v nvim &>/dev/null ]; then
  log "[+] Neovim detected! ($(which nvim))"
else
  log "[-] Neovim not installed, installing now..."
  pacman -S nvim --noconfirm &>/dev/null
  log "[+] Neovim installed! ($(which nvim))"
fi

log "[*] Configuring NvChad for Neovim..."
git clone https://github.com/NvChad/NvChad /home/$USER/.config/nvim --depth 1 &>/dev/null
log "[+] NvChad Configured (during first launch it will install all add-ons; next time it will be ready)!"
